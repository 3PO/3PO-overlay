#!/bin/bash

# set -x

PLEX_CONF="/etc/plex/plexmediaserver.conf"

if [ ! "$PLEX_CONF" ] ; then
  echo "WARNING COULDN\'T FIND PLEX CONFIG FILE! (--> $PLEX_CONF)"
  exit 1
fi

source "$PLEX_CONF"

export PLEX_USER="${PLEX_USER}" 
export PLEX_MEDIA_SERVER_HOME="${PLEX_MEDIA_SERVER_HOME}"
export PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR="${PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR}"
export PLEX_MEDIA_SERVER_MAX_PLUGIN_PROCS="${PLEX_MEDIA_SERVER_MAX_PLUGIN_PROCS}"
export PLEX_MEDIA_SERVER_MAX_STACK_SIZE="${PLEX_MEDIA_SERVER_MAX_STACK_SIZE}"
export PLEX_MEDIA_SERVER_MAX_OPEN_FILES="${PLEX_MEDIA_SERVER_MAX_OPEN_FILES}"
export PLEX_MEDIA_SERVER_TMPDIR="${PLEX_MEDIA_SERVER_TMPDIR}"


[ "$PLEX_MEDIA_SERVER_USE_SYSLOG" == "true" ] && export export PLEX_MEDIA_SERVER_USE_SYSLOG=true

export LD_LIBRARY_PATH="${PLEX_MEDIA_SERVER_HOME}"



if [ ! -d "$PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR" ] ; then
  mkdir -p "$PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR"
  if [ ! $? -eq 0 ] ; then
    echo "WARNING COULDN\'T CREATE $PLEX_MEDIA_SERVER_APPLICATION_SUPPORT_DIR, MAKE SURE I HAVE PERMISSON TO DO THAT!"
    exit 1
  fi
fi

ulimit -s "$PLEX_MEDIA_SERVER_MAX_STACK_SIZE"
ulimit -n "$PLEX_MEDIA_SERVER_MAX_OPEN_FILES"

LANGUAGE="$(locale |head -n 1)"
export "$LANGUAGE"


cd "${PLEX_MEDIA_SERVER_HOME}"
./Plex\ Media\ Server







